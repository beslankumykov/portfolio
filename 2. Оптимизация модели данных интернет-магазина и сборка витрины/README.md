# Оптимизация модели данных интернет-магазина и сборка витрины

## Описание проекта

### Описание исходных данных

Все исходные данные лежат в таблице shipping со следующими атрибутами:
- id — уникальный идентификатор записи в таблице.
- shipping_id — уникальный идентификатор доставки.
- sale_id — уникальный идентификатор продажи. К одной продаже может быть привязано несколько строчек shipping_id, то есть логов, с информацией о доставке.
- order_id — уникальный идентификатор заказа.
- client_id — уникальный идентификатор клиента.
- payment_amount — сумма платежа (то есть дублирующаяся информация).
- state_datetime — время обновления состояния заказа.
- product_id — уникальный идентификатор товара.
- description — полное описание товара.
- vendor_id — уникальный идентификатор вендора. К одному вендору может быть привязано множество sale_id и множество строк доставки.
- name_category — название категории товара.
- base_country — страна производитель.
- status - статус доставки в таблице shipping по данному shipping_id. Может принимать значения in_progress — доставка в процессе, либо finished — доставка завершена.
- state — промежуточные точки заказа, которые изменяются в соответствии с обновлением информации о доставке по времени state_datetime.
- shipping_plan_datetime — плановая дата доставки.
- hours_to_plan_shipping — запланированное количество часов на доставку.
- shipping_transfer_description — строка со значениями transfer_type — тип доставки и transfer_model — модель доставки, записанными через :. Пример записи — 1p:car.
- shipping_transfer_rate — процент стоимости доставки для вендора в зависимости от типа и модели доставки, который взимается интернет-магазином для покрытия расходов.
- shipping_country — страна доставки, учитывая описание тарифа для каждой страны.
- shipping_country_base_rate — налог на доставку в страну, который является процентом от стоимости payment_amount.
- vendor_agreement_description  — строка, в которой содержатся данные agreement_id — идентификатор договора, agreement_number — номер договора в бухгалтерии, agreement_rate — ставка налога за стоимость доставки товара для вендора, agreement_commission — комиссия, записанные через разделитель «:». Пример записи — 12:vsp-34:0.02:0.023.

### Ход решения задачи

1. Создан справочник стоимости доставки в страны shipping_country_rates из данных, указанных в полях shipping_country и shipping_country_base_rate таблицы shipping.
2. Создан справочник тарифов доставки вендора по договору shipping_agreement из данных в поле vendor_agreement_description таблицы shipping.
3. Создан справочник типов доставки shipping_transfer из строки shipping_transfer_description таблицы shipping.
4. Создана фактовая таблица shipping_info с информацией о доставке в полях shipping_plan_datetime, payment_amount, vendorid и связана с тремя созданными ранее справочниками через внешние ключи.
5. Создана таблица статусов о доставке shipping_status с информацией о статусе и состоянии доставок, а также, с временем фактического начала и окончания доставки.
6. Создано представление shipping_datamart на основании готовых таблиц для аналитики, которое включает следующие атрибуты:
- shippingid - идентификатор доставки
- vendorid - идентификатор вендора
- transfer_type — тип доставки
- full_day_at_shipping - количество полных дней, в течение которых длилась доставка
- is_delay - статус, показывающий просрочена ли доставка
- is_shipping_finish - статус, показывающий, что доставка завершена
- delay_day_at_shipping - количество дней, на которые была просрочена доставка
- payment_amount - сумма платежа пользователя
- vat - итоговый налог на доставку
- profit - итоговый доход компании с доставки

### Итоговая схема данных

![Image](https://github.com/beslankumykov/portfolio/assets/87646293/95ea47f9-dd92-4f1b-9c15-cb326fbb5d03)

## Стек технологий

`Airflow` `Python` `PostgreSQL` `SQL`

## Статус проекта

Завершен.
