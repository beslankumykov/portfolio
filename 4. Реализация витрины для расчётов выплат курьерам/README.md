# Реализация витрины для расчётов выплат курьерам

## Описание задачи
Необходимо построить витрину, содержащую информацию о выплатах курьерам, со следующими атрибутами:
- id — идентификатор записи.
- courier_id — ID курьера, которому перечисляем.
- courier_name — Ф. И. О. курьера.
- settlement_year — год отчёта.
- settlement_month — месяц отчёта, где 1 — январь и 12 — декабрь.
- orders_count — количество заказов за период (месяц).
- orders_total_sum — общая стоимость заказов.
- rate_avg — средний рейтинг курьера по оценкам пользователей.
- order_processing_fee — сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum * 0.25.
- courier_order_sum — сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга.
- courier_tips_sum — сумма, которую пользователи оставили курьеру в качестве чаевых.
- courier_reward_sum — сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum * 0.95 (5% — комиссия за обработку платежа).

Данные курьерской службы необходимо забрать по API, после чего совместить их с данными подсистемы заказов.

## Спецификация API

Метод **GET /restaurants** возвращает список доступных ресторанов. Пример вызова:
```bash
curl --location --request GET 'https://d5d04q7d963eapoepsqr.apigw.yandexcloud.net/restaurants?sort_field={{ sort_field }}&sort_direction={{ sort_direction }}&limit={{ limit }}&offset={{ offset }}' \
--header 'X-Nickname: {{ nickname }}' \
--header 'X-Cohort: {{ cohort_number }}' \
--header 'X-API-KEY: {{ api_key }}' 
```
, где:
- sort_field — необязательный параметр. Возможные значения: id, name. Значение по умолчанию: id. Параметр определяет поле, к которому будет применяться сортировка, переданная в параметре sort_direction.
- sort_direction — необязательный параметр. Возможные значения: asc, desc. Параметр определяет порядок сортировки для поля, переданного в sort_field: asc — сортировка по возрастанию, desc — сортировка по убыванию.
- limit — необязательный параметр. Значение по умолчанию: 50. Возможные значения: целое число в интервале от 0 до 50 включительно. Параметр определяет максимальное количество записей, которые будут возвращены в ответе.
- offset — необязательный параметр. Значение по умолчанию: 0. Параметр определяет количество возвращаемых элементов результирующей выборки, когда формируется ответ.

Метод возвращает список ресторанов. Каждый ресторан списка содержит:
- _id — ID задачи
- name — название ресторана
  
Метод **GET /couriers** используется для того, чтобы получить список курьеров с учётом фильтров, переданных в запросе. Пример вызова:
```bash
curl --location --request GET 'https://d5d04q7d963eapoepsqr.apigw.yandexcloud.net/couriers?sort_field={{ sort_field }}&sort_direction={{ sort_direction }}&limit={{ limit }}&offset={{ offset }}' \
--header 'X-Nickname: {{ nickname }}' \
--header 'X-Cohort: {{ cohort_number }}' \
--header 'X-API-KEY: {{ api_key }}' 
```
Параметры аналогичны параметрам в предыдущем методе. </br>
Метод возвращает список курьеров. Каждый элемент списка содержит:
- _id — ID курьера в БД
- name — имя курьера

Метод **GET /deliveries** используется для того, чтобы получить список совершённых доставок с учётом фильтров, переданных в запросе. Пример вызова:
```bash
curl --location --request GET 'https://d5d04q7d963eapoepsqr.apigw.yandexcloud.net/deliveries?restaurant_id={{ restaurant_id }}&from={{ from }}&to={{ to }}&sort_field={{ sort_field }}&sort_direction={{ sort_direction }}&limit={{ limit }}&offset={{ limit }}' \
--header 'X-Nickname: {{ your_nickname }}' \
--header 'X-Cohort: {{ your_cohort_number }}' \
--header 'X-API-KEY: {{ api_key }}' 
```
, где помимо описанных параметров sort_direction, limit, offset используются параметры:
- sort_field — необязательный параметр. Возможные значения: _id, date. Если указать _id, то будет применена сортировка по ID заказа order_id. Если указать date, то будет применена сортировка по дате создания заказа order_ts.
- restaurant_id — ID ресторана. Если значение не указано, то метод вернёт данные по всем доступным в БД ресторанам.
- from — параметр фильтрации. В выборку попадают заказы с датой доставки, которая больше или равна значению from. Дата должна быть в формате '%Y-%m-%d %H:%M:%S’, например, 2022-01-01 00:00:00.
- to — параметр фильтрации. В выборку попадают заказы с датой доставки меньше значения to.
Метод возвращает список совершённых доставок с учётом фильтров в запросе. Каждый элемент списка содержит:
- order_id — ID заказа;
- order_ts — дата и время создания заказа;
- delivery_id — ID доставки;
- courier_id — ID курьера;
- address — адрес доставки;
- delivery_ts — дата и время совершения доставки;
- rate — рейтинг доставки, который выставляет покупатель: целочисленное значение от 1 до 5;
- sum — сумма заказа (в руб.);
- tip_sum — сумма чаевых, которые оставил покупатель курьеру (в руб.).

## Схема данных DWH

![snowflake](https://github.com/beslankumykov/portfolio/assets/87646293/d47ee497-5fc0-45bf-830c-cbac865a7bfb)

